目录

[TOC]

# 客户端和服务端的交互模型
1. 客户端
2. DNS 解析服务器：记录所有的域名解析记录。访问域名时，对域名进行DNS解析：找到`对应的服务器外网IP`。
DNS（Domain Name System，域名系统），万维网上作为域名和服务器 IP 地址相互映射的一个分布式数据库。

3. 服务器端
- 服务器上是不允许安装除了开发需要的环境项以外的任何东西，因为服务器上安装一款应用都可能会作为一个服务，占用一个端口
- 开发者基于`FTP`把项目源文件上传到服务器指定的磁盘。
- 服务器上的项目是`基于端口号`区分的，不同的端口号管控不同的项目。
- 给服务器联网后，服务器会有一个自己的外网IP（一般都会禁止通过外网IP访问网站）

4. 发布WEB站的部署工具：IIS（C#...Windows）、APACHE TOMCOT（PHP/JAVA...->Linux）、NGINX。
指定当前域名访问服务器后，执行的是哪一个项目的源代码关联。


# 面试题：从输入一个 URL 到渲染出页面的整个过程
> 面试题：打开一个浏览器，在地址栏输入一个 URL，按下 enter 键，到看到整个页面。中间都经历了哪些步骤？

加载资源的形式：
1）html 代码
2）媒体文件，如 音视频、img等
3）js css 代码


1. 域名解析（DNS）阶段
向服务器发送请求
- 浏览器首先向 DNS 解析服务器发送域名
- DNS 反解析：通过`域名`，找到`对应的服务器外网IP`
- 把找到的外网 IP 返回给浏览器，浏览器再根据 IP 地址向对应的服务器发送请求

2. HTTP 请求阶段
根据拿到的 IP 地址，与服务器建立 TCP 链接。
必然要说 TCP 三次握手：
为什么要 TCP 三次握手？目的是“为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误”。
第一次握手，由浏览器发起，发送一个带有SYN标志的数据包给服务端（告诉服务器我要发送请求了）
第二次握手，由服务器发起，回传一个带有 SYN/ACK 标志的数据包以示传达确认信息（告诉浏览器我可以接受了，你发吧）
第三次握手，由浏览器发送，回传一个带ACK标志的数据包，代表“握手结束”，连接成功。


![TCP3](https://user-images.githubusercontent.com/22387652/91374583-17572600-e84b-11ea-9d50-3006c7be14ee.png)

上图也可以这么理解：
客户端：“你好，在家不，有你快递。”
服务端：“在的，送来就行。”
客户端：“好嘞。”

与服务器连接成功之后，开始发送 HTTP 请求。




3. HTTP 响应阶段
服务器把浏览器需要的内容准备好，响应给客户端
- 通过 URL 中的`端口号`，匹配出请求的时服务器上哪个服务（项目），以及服务所管理的项目源文件
- 服务器端根据URL中的路径名称、问号传参或者哈希值，把客户端需要的内容进行准备和处理
- 把准备内容响应给客户端（如果请求的是 html、js、css 等资源文件，服务器返回文件的`源代码`[不是文件本身]，`音视频、img 除外`）

4. 断开 TCP 连接
当数据传送完毕，需要断开 TCP 连接，此时发起 TCP 四次挥手。
第一次挥手：由浏览器发起的，发送给服务器，我请求报文发送完了，你准备关闭吧
第二次挥手：由服务器发起的，告诉浏览器，我请求报文接受完了，我准备关闭了，你也准备吧
第三次挥手：由服务器发起，告诉浏览器，我响应报文发送完了，你准备关闭吧
第四次挥手：由浏览器发起，告诉服务器，我响应报文接受完了，我准备关闭了，你也准备吧

![TCP4](https://user-images.githubusercontent.com/22387652/91375631-cf85ce00-e84d-11ea-8fc1-1b667e820af0.png)



5. 浏览器渲染阶段
客户端浏览器接收到服务器返回的源代码，基于自己内部的渲染引擎（内核）开始进行页面的绘制和渲染
	+ 首先计算 DOM 结构，生成 DOM Tree
	+ 根据 css 代码生成 CSSOM（CSS 对象模型）
	+ 将 DOM tree 和 CSSOM 整合形成 Render Tree
	+ 开始渲染（绘制）页面
  + 遇到 link、script 则暂停渲染，优先加载并执行 JS 代码，完成再继续渲染
  + 直至把 Render Tree 渲染完成




注意：遇到 link、script，只要文件不在当前返回的页面中，就会再次向服务器发送一次请求，每一次请求都会重头开始走 1,2,3 的所有步骤。

[经典面试题：从 URL 输入到页面展现到底发生什么？](https://zhuanlan.zhihu.com/p/57895541)


# 思考
1. 为什么把 css 文件的加载放在 head 标签中？

因为是先加载 head 中的 CSS 代码生成 CSSOM，然后再根据 HTML 结构生成 DOM tree，这样就可以直接整合成 Render Tree。如果 把 CSS 放在 DOM 之后，会先加载 无样式的 DOM tree，发现有 CSS 代码，生成 CSSOM，重新 生成 DOM tree，然后再整合为 Render Tree。 避免重复 的 DOM 渲染。

如果将 css 放在头部，css的下载解析是可以和html的解析同步进行的，放到尾部，要花费额外时间来解析CSS，并且浏览器会先渲染出一个没有样式的页面，等CSS加载完后会再渲染成一个有样式的页面，页面会出现明显的闪动的现象。

2. 为什么把 script 文件放在 body 最底下？
因为遇到 script 会暂停渲染，把先能出来的东西渲染出来，让用户看到内容，然后再加载 JS

img 不会暂停渲染，等图片回来直接插入即可。


# 结束
***重学 JS 系列*** 预计 25 篇左右，这是一个旨在帮助大家，其实也是帮助我自己捋顺 JavaScript 底层知识的系列。主要包括变量和类型、执行上下文、作用域及闭包、原型和继承、单线程和异步、JS Web API、渲染和优化几个部分，将重点讲解如执行上下文、作用域、闭包、this、call、apply、bind、原型、继承、Event-loop、宏任务和微任务等比较难懂的部分。让我们一起拥抱整个 JavaScript 吧。

大家或有疑问、或指正、或鼓励、或感谢，尽管留言回复哈！非常欢迎 star 哦！

[点击返回博客主页](https://github.com/chenchen0224/webfrontend-space)